{"ast":null,"code":"import { createSlice, createAsyncThunk } from \"@reduxjs/toolkit\";\nimport axios from \"axios\";\nimport { url } from \"./api\";\nimport jwtDecode from \"jwt-decode\";\nconst initialState = {\n  token: localStorage.getItem(\"token\"),\n  //check local storage for token, buitl in JS object\n  name: \"\",\n  email: \"\",\n  _id: \"\",\n  registerStatus: \"\",\n  //pending, fullfilled, or reject\n  registerError: \"\",\n  loginStatus: \"\",\n  loginError: \"\",\n  userLoaded: false\n}; //action creator --> performs http request to backend, register user, get back token, then should be avaialble to action.payload, in case error you also add to pay;oad\n\nexport const registerUser = createAsyncThunk(\"auth/registerUser\", async (values, _ref) => {\n  let {\n    rejectWithValue\n  } = _ref;\n\n  try {\n    //handle error, http request a call to backend\n    const token = await axios.post(`${url}/register`, {\n      name: values.name,\n      email: values.email,\n      password: values.password\n    });\n    localStorage.setItem(\"token\", token.data);\n    return token.data;\n  } catch (err) {\n    console.log(err.response.data);\n    return rejectWithValue(err.response.data);\n  }\n});\nexport const loginUser = createAsyncThunk(\"auth/loginUser\", //name is for dispatched action\nasync (values, _ref2) => {\n  let {\n    rejectWithValue\n  } = _ref2;\n\n  try {\n    //handle error, http request a call to backend \n    const token = await axios.post(`${url}/login`, {\n      //<-- http request \n      email: values.email,\n      password: values.password\n    });\n    localStorage.setItem(\"token\", token.data);\n    return token.data;\n  } catch (err) {\n    console.log(err.response);\n    return rejectWithValue(err.response.data);\n  }\n});\nexport const getUser = createAsyncThunk(\"auth/getUser\", async (id, _ref3) => {\n  let {\n    rejectWithValue\n  } = _ref3;\n\n  try {\n    const token = await axios.get(`${url}/user/${id}`, setHeaders());\n    localStorage.setItem(\"token\", token.data);\n    return token.data;\n  } catch (error) {\n    console.log(error.response);\n    return rejectWithValue(error.response.data);\n  }\n});\nconst authReducer = createSlice({\n  name: \"auth\",\n  initialState,\n  reducers: {\n    loadUser(state, action) {\n      const token = state.token; //state has token bc can get from local storage\n\n      if (token) {\n        const user = jwtDecode(token);\n        return { ...state,\n          token,\n          name: user.name,\n          email: user.email,\n          _id: user._id,\n          userLoaded: true\n        };\n      } else return { ...state,\n        userLoaded: true\n      };\n    },\n\n    logoutUser(state, action) {\n      localStorage.removeItem(\"token\");\n      return { ...state,\n        token: \"\",\n        name: \"\",\n        email: \"\",\n        _id: \"\",\n        registerStatus: \"\",\n        //pending, fullfilled, or reject\n        registerError: \"\",\n        loginStatus: \"\",\n        loginError: \"\",\n        userLoaded: false\n      };\n    }\n\n  },\n  //we will be creating reducer and action will automatically created by redux toolkit\n  extraReducers: builder => {\n    builder.addCase(registerUser.pending, (state, action) => {\n      return { ...state,\n        registerStatus: \"pending\"\n      };\n    });\n    builder.addCase(registerUser.fulfilled, (state, action) => {\n      if (action.payload) {\n        const user = jwtDecode(action.payload);\n        return { ...state,\n          token: action.payload,\n          name: user.name,\n          email: user.email,\n          _id: user._id,\n          registerStatus: \"success\"\n        };\n      } else return state;\n    });\n    builder.addCase(rejisterUser.rejected, (state, action) => {\n      return { ...state,\n        registerStatus: \"rejected\",\n        registerError: action.payload\n      };\n    });\n    builder.addCase(loginUser.pending, (state, action) => {\n      return { ...state,\n        registerStatus: \"pending\"\n      };\n    });\n    builder.addCase(loginUser.fulfilled, (state, action) => {\n      if (action.payload) {\n        const user = jwtDecode(action.payload);\n        return { ...state,\n          token: action.payload,\n          name: user.name,\n          email: user.email,\n          _id: user._id,\n          registerStatus: \"success\"\n        };\n      } else return state;\n    });\n    builder.addCase(loginUser.rejected, (state, action) => {\n      return { ...state,\n        loginStatus: \"rejected\",\n        loginError: action.payload\n      };\n    });\n    builder.addCase(getUser.pending, (state, action) => {\n      return { ...state,\n        getUserStatus: \"pending\"\n      };\n    });\n    builder.addCase(getUser.fulfilled, (state, action) => {\n      if (action.payload) {\n        const user = jwtDecode(action.payload); //i think the action payload generates token\n\n        return { ...state,\n          token: action.payload,\n          name: user.name,\n          email: user.email,\n          _id: user._id,\n          getUserStatus: \"success\"\n        };\n      } else return state;\n    });\n    builder.addCase(getUser.rejected, (state, action) => {\n      return { ...state,\n        getUserStatus: \"rejected\",\n        getUserError: action.payload\n      };\n    });\n  }\n} //accepting object\n);\nexport const {\n  loadUser,\n  logoutUser\n} = authSlice.actions;\nexport default authReducer.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","axios","url","jwtDecode","initialState","token","localStorage","getItem","name","email","_id","registerStatus","registerError","loginStatus","loginError","userLoaded","registerUser","values","rejectWithValue","post","password","setItem","data","err","console","log","response","loginUser","getUser","id","get","setHeaders","error","authReducer","reducers","loadUser","state","action","user","logoutUser","removeItem","extraReducers","builder","addCase","pending","fulfilled","payload","rejisterUser","rejected","getUserStatus","getUserError","authSlice","actions","reducer"],"sources":["/Users/lilosivert/Downloads/Code/React-Development/Online-Shop/Front-End/src/features/authSlice.js"],"sourcesContent":["import {createSlice, createAsyncThunk} from \"@reduxjs/toolkit\";\nimport axios from \"axios\"\nimport { url } from \"./api\";\nimport jwtDecode from \"jwt-decode\"\n\nconst initialState = {\n    token: localStorage.getItem(\"token\"),//check local storage for token, buitl in JS object\n    name: \"\",\n    email: \"\",\n    _id: \"\",\n    registerStatus: \"\",//pending, fullfilled, or reject\n    registerError: \"\",\n    loginStatus: \"\",\n    loginError: \"\",\n    userLoaded: false,\n};\n\n//action creator --> performs http request to backend, register user, get back token, then should be avaialble to action.payload, in case error you also add to pay;oad\nexport const registerUser = createAsyncThunk(\n    \"auth/registerUser\",\n    async (values, {rejectWithValue}) => {\n        try{//handle error, http request a call to backend\n            const token = await axios.post(`${url}/register`, {\n                name: values.name,\n                email: values.email,\n                password: values.password,\n            });\n\n            localStorage.setItem(\"token\", token.data);\n\n            return token.data;\n        }\n        catch(err) {\n            console.log(err.response.data);\n            return rejectWithValue(err.response.data);\n        }\n\n    }\n);\n\nexport const loginUser = createAsyncThunk(\n    \"auth/loginUser\", //name is for dispatched action\n    async (values, {rejectWithValue}) => {\n        try{//handle error, http request a call to backend \n            const token = await axios.post(`${url}/login`, { //<-- http request \n                email: values.email,\n                password: values.password,\n            });\n\n            localStorage.setItem(\"token\", token.data);\n\n            return token.data;\n        }\n        catch(err) {\n            console.log(err.response);\n            return rejectWithValue(err.response.data);\n        }\n\n    }\n);\n\nexport const getUser = createAsyncThunk(\n    \"auth/getUser\",\n    async (id, { rejectWithValue }) => {\n      try {\n        const token = await axios.get(`${url}/user/${id}`, setHeaders());\n  \n        localStorage.setItem(\"token\", token.data);\n  \n        return token.data;\n      } catch (error) {\n        console.log(error.response);\n        return rejectWithValue(error.response.data);\n      }\n    }\n  );\n\n\nconst authReducer = createSlice(\n    {\n        name: \"auth\",\n        initialState,\n        reducers: {\n            loadUser(state, action){\n                const token = state.token //state has token bc can get from local storage\n\n                if(token){\n                    const user = jwtDecode(token)\n                    return {\n                        ...state,\n                        token,\n                        name: user.name,\n                        email: user.email,\n                        _id: user._id,\n                        userLoaded: true,\n                    };\n                } else return {...state, userLoaded: true}\n            },\n            logoutUser(state, action){\n                localStorage.removeItem(\"token\")\n\n                return {\n                    ...state,\n                    token: \"\",\n                    name: \"\",\n                    email: \"\",\n                    _id: \"\",\n                    registerStatus: \"\",//pending, fullfilled, or reject\n                    registerError: \"\",\n                    loginStatus: \"\",\n                    loginError: \"\",\n                    userLoaded: false,\n                };\n            },\n        }, //we will be creating reducer and action will automatically created by redux toolkit\n        extraReducers: (builder) => {\n            builder.addCase(registerUser.pending, (state, action) => {\n                return { ...state, registerStatus: \"pending\"};\n            });\n            builder.addCase(registerUser.fulfilled, (state, action) => {\n                if(action.payload){\n                    const user = jwtDecode(action.payload);\n\n                    return{\n                        ...state,\n                        token: action.payload,\n                        name: user.name,\n                        email: user.email,\n                        _id: user._id,\n                        registerStatus: \"success\"\n                    };\n                }\n                else return state;\n            });\n            builder.addCase(rejisterUser.rejected, (state, action) => {\n                return {\n                    ...state,\n                    registerStatus: \"rejected\",\n                    registerError: action.payload\n                };\n            });\n\n\n            builder.addCase(loginUser.pending, (state, action) => {\n                return { ...state, registerStatus: \"pending\"};\n            });\n            builder.addCase(loginUser.fulfilled, (state, action) => {\n                if(action.payload){\n                    const user = jwtDecode(action.payload);\n\n                    return{\n                        ...state,\n                        token: action.payload,\n                        name: user.name,\n                        email: user.email,\n                        _id: user._id,\n                        registerStatus: \"success\"\n                    };\n                }\n                else return state;\n            });\n            builder.addCase(loginUser.rejected, (state, action) => {\n                return {\n                    ...state,\n                    loginStatus: \"rejected\",\n                    loginError: action.payload\n                };\n            });\n\n\n            builder.addCase(getUser.pending, (state,action) => {\n                return {\n                    ...state,\n                    getUserStatus: \"pending\",\n                };\n            });\n            builder.addCase(getUser.fulfilled, (state, action) => {\n                if(action.payload) {\n                    const user = jwtDecode(action.payload) //i think the action payload generates token\n                    return {\n                        ...state,\n                        token: action.payload,\n                        name: user.name,\n                        email: user.email,\n                        _id: user._id,\n                        getUserStatus: \"success\",\n                    };\n                } else return state;\n            });\n            builder.addCase(getUser.rejected, (state,action) => {\n                return {\n                    ...state,\n                    getUserStatus: \"rejected\",\n                    getUserError: action.payload,\n                };\n            });\n        },\n    }//accepting object\n);\n\nexport const {loadUser, logoutUser} = authSlice.actions\n\nexport default authReducer.reducer"],"mappings":"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"},"metadata":{},"sourceType":"module"}