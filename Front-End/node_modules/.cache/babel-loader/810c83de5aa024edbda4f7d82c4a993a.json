{"ast":null,"code":"import { createSlice, createAsyncThunk } from \"@reduxjs/toolkit\";\nimport axios from \"axios\";\nimport { url } from \"./api\";\nimport jwtDecode from \"jwt-decode\";\nconst initialState = {\n  token: localStorage.getItem(\"token\"),\n  //check local storage for token, buitl in JS object\n  name: \"\",\n  email: \"\",\n  _id: \"\",\n  registerStatus: \"\",\n  //pending, fullfilled, or reject\n  registerError: \"\",\n  loginStatus: \"\",\n  loginError: \"\",\n  userLoaded: false\n}; //action creator --> performs http request to backend, register user, get back token, then should be avaialble to action.payload, in case error you also add to pay;oad\n\nexport const registerUser = createAsyncThunk(\"auth/registerUser\", async (user, _ref) => {\n  let {\n    rejectWithValue\n  } = _ref;\n\n  try {\n    //handle error, http request a call to backend\n    const token = await axios.post(`${url}/register`, {\n      name: values.name,\n      email: values.email,\n      password: values.password\n    });\n    localStorage.setItem(\"token\", token.data);\n    return token.data;\n  } catch (err) {\n    console.log(err.response.data);\n    return rejectWithValue(err.response.data);\n  }\n});\nexport const loginUser = createAsyncThunk(\"auth/loginUser\", //name is for dispatched action\nasync (user, _ref2) => {\n  let {\n    rejectWithValue\n  } = _ref2;\n\n  try {\n    //handle error, http request a call to backend \n    const token = await axios.post(`${url}/login`, {\n      //<-- http request \n      email: values.email,\n      password: values.password\n    });\n    localStorage.setItem(\"token\", token.data);\n    return token.data;\n  } catch (err) {\n    console.log(err.response.data);\n    return rejectWithValue(err.response.data);\n  }\n});\nconst authReducer = createSlice({\n  name: \"auth\",\n  initialState,\n  reducers: {\n    loadUser(state, action) {\n      const token = state.token; //state has token bc can get from local storage\n\n      if (token) {\n        const user = jwtDecode(token);\n        return { ...state,\n          token,\n          name: user.name,\n          email: user.email,\n          _id: user._id,\n          userLoaded: true\n        };\n      }\n    },\n\n    logoutUser(state, action) {\n      localStorage.removeItem(\"token\");\n      return { ...state,\n        token: \"\",\n        name: \"\",\n        email: \"\",\n        _id: \"\",\n        registerStatus: \"\",\n        //pending, fullfilled, or reject\n        registerError: \"\",\n        loginStatus: \"\",\n        loginError: \"\",\n        userLoaded: false\n      };\n    }\n\n  },\n  //we will be creating reducer and action will automatically created by redux toolkit\n  extraReducers: builder => {\n    builder.addCase(registerUser.pending, (state, action) => {\n      return { ...state,\n        registerStatus: \"pending\"\n      };\n    });\n    builder.addCase(registerUser.fulfilled, (state, action) => {\n      if (action.payload) {\n        const user = jwtDecode(action.payload);\n        return { ...state,\n          token: action.payload,\n          name: user.name,\n          email: user.email,\n          _id: user._id,\n          registerStatus: \"success\"\n        };\n      } else return state;\n    });\n    builder.addCase(registerUser.rejected, (state, action) => {\n      return { ...state,\n        registerStatus: \"rejected\",\n        registerError: action.payload\n      };\n    });\n  }\n} //accepting object\n);\nexport const {\n  loadUser,\n  logoutUser\n} = authSlice.actions;\nexport default authReducer.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","axios","url","jwtDecode","initialState","token","localStorage","getItem","name","email","_id","registerStatus","registerError","loginStatus","loginError","userLoaded","registerUser","user","rejectWithValue","post","values","password","setItem","data","err","console","log","response","loginUser","authReducer","reducers","loadUser","state","action","logoutUser","removeItem","extraReducers","builder","addCase","pending","fulfilled","payload","rejected","authSlice","actions","reducer"],"sources":["/Users/lilosivert/Downloads/Code/React-Development/Online-Shop/Front-End/src/features/authSlice.js"],"sourcesContent":["import {createSlice, createAsyncThunk} from \"@reduxjs/toolkit\";\nimport axios from \"axios\"\nimport { url } from \"./api\";\nimport jwtDecode from \"jwt-decode\"\n\nconst initialState = {\n    token: localStorage.getItem(\"token\"),//check local storage for token, buitl in JS object\n    name: \"\",\n    email: \"\",\n    _id: \"\",\n    registerStatus: \"\",//pending, fullfilled, or reject\n    registerError: \"\",\n    loginStatus: \"\",\n    loginError: \"\",\n    userLoaded: false,\n};\n\n//action creator --> performs http request to backend, register user, get back token, then should be avaialble to action.payload, in case error you also add to pay;oad\nexport const registerUser = createAsyncThunk(\n    \"auth/registerUser\",\n    async (user, {rejectWithValue}) => {\n        try{//handle error, http request a call to backend\n            const token = await axios.post(`${url}/register`, {\n                name: values.name,\n                email: values.email,\n                password: values.password,\n            });\n\n            localStorage.setItem(\"token\", token.data);\n\n            return token.data;\n        }\n        catch(err) {\n            console.log(err.response.data);\n            return rejectWithValue(err.response.data);\n        }\n\n    }\n)\n\nexport const loginUser = createAsyncThunk(\n    \"auth/loginUser\", //name is for dispatched action\n    async (user, {rejectWithValue}) => {\n        try{//handle error, http request a call to backend \n            const token = await axios.post(`${url}/login`, { //<-- http request \n                email: values.email,\n                password: values.password,\n            });\n\n            localStorage.setItem(\"token\", token.data);\n\n            return token.data;\n        }\n        catch(err) {\n            console.log(err.response.data);\n            return rejectWithValue(err.response.data);\n        }\n\n    }\n)\n\nconst authReducer = createSlice(\n    {\n        name: \"auth\",\n        initialState,\n        reducers: {\n            loadUser(state, action){\n                const token = state.token //state has token bc can get from local storage\n\n                if(token){\n                    const user = jwtDecode(token)\n                    return {\n                        ...state,\n                        token,\n                        name: user.name,\n                        email: user.email,\n                        _id: user._id,\n                        userLoaded: true,\n                    };\n                }\n            },\n            logoutUser(state, action){\n                localStorage.removeItem(\"token\")\n\n                return {\n                    ...state,\n                    token: \"\",\n                    name: \"\",\n                    email: \"\",\n                    _id: \"\",\n                    registerStatus: \"\",//pending, fullfilled, or reject\n                    registerError: \"\",\n                    loginStatus: \"\",\n                    loginError: \"\",\n                    userLoaded: false,\n                };\n            },\n        }, //we will be creating reducer and action will automatically created by redux toolkit\n        extraReducers: (builder) => {\n            builder.addCase(registerUser.pending, (state, action) => {\n                return { ...state, registerStatus: \"pending\"};\n            });\n            builder.addCase(registerUser.fulfilled, (state, action) => {\n                if(action.payload){\n                    const user = jwtDecode(action.payload);\n\n                    return{\n                        ...state,\n                        token: action.payload,\n                        name: user.name,\n                        email: user.email,\n                        _id: user._id,\n                        registerStatus: \"success\"\n                    };\n                }\n                else return state;\n            });\n            builder.addCase(registerUser.rejected, (state, action) => {\n                return {\n                    ...state,\n                    registerStatus: \"rejected\",\n                    registerError: action.payload\n                };\n            });\n        },\n    }//accepting object\n);\n\nexport const {loadUser, logoutUser} = authSlice.actions\n\nexport default authReducer.reducer"],"mappings":"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"},"metadata":{},"sourceType":"module"}